# История изменений

##### build_iso_images.sh

v2.210505
- Вывод команды `ls` теперь можно фильтровать, указав в качестве параметров имена сборок
  настройки которых только и надо отобразить
- Теперь очередность сборок при команде 'build' повторяет очередность указания их в командной строке,
  а не в конфигурационном файле, как было ранее

v2.210427
- Теперь пропускаем сборку если скрипт деплоя не был найден (ранее просто игнорировалось)
- Добавлена запись в ISO-образ специального файла `.build_version` с параметрами сборки

v2.210426
- Добавлена возможность указания команд необходимых для сборки базового слоя в специальном файле
  `.dependencies` вместо добавления такой проверки в скрипты `.build.sh` и `.pre_images.sh`
- Мелкие улучшения в информационных сообщениях

v2.210422
- Добавлена поддержка **шаблонов**: теперь скрипт умеет собирать любое множество ISO-образов,
  каждый из которых состоит из базового слоя и `git`-репозитария со скриптами деплоя,
  а их конфигурация теперь описывается в конфигурационном файле
- Реализовано кеширование артефактов базовых слоёв, пересборка их вызывается автоматически
  при изменении любого файла в папке базового слоя (`base_layers/`)
- Подготовлен базовый слой `xenial-amd64-minbase`
- Добавлен команда 'ls' для отображения настроек конфигурационного файла
- Скрипт переименован из `build_ubuntu_livecd` в `build_iso_images`, т.к. теперь скрипт не привязан
  к конкретному дистрибутиву и может собирать ISO-образы для любой операционной системы

v1.210326
- Добавлена установка временной зоны через `guestinfo.timezone` параметр

v1.210322
- Добавлен `sysctl`-параметр `kernel.panic` для автоматической перезагрузки виртуальной машины

v1.210318
- Исправлена ошибка с невозможность корректного выключения виртуальной машины из-за сообщения:
  `Please remove the installation medium, then press Enter:`

v1.210316
- Добавлена поддержка распаковки .tgz архивов из provision_files/
- Добавлена поддержка установки hostname виртуальной машины из `guestinfo.hostname` параметра
- Сетевые настройки теперь также передаются через `guestinfo` параметры, а не MAC-адрес
- Теперь по умолчанию используется `8.8.8.8` в качестве DNS сервера

##### control_vm_esxi.sh

v2.210512
- Добавлена поддержка хуков (добавлен новый параметр `local_hook_path`)
- При уничтожении виртуальной машины теперь также дожидаемся обновления её статуса
  (подобная проверка была для операций power on, power off, power shutdown)

v2.210505
- Вывод команды `ls` теперь можно фильтровать, указав в качестве параметров имена виртуальных машин
  или гипервизоров настройки которых только и надо отобразить
- Для команды `create` в качестве параметров теперь можно указывать не только имена виртуальных машин,
  но и имена гипервизоров, что добавит в список обработки все виртуальные машины находящиеся на указанных гипервизорах;
  Однако теперь имена виртуальных машин и гипервизоров не должны пересекаться в конфигурационном файле
- Теперь очередность создания виртуальных машин при команде 'create' повторяет очередность указания их
  в командной строке, а не в конфигурационном файле, как было ранее

v2.210427
- Добавлен ключ `-f` для команды `create`, который пересоздаёт уже имеющийся на гипервизоре инстанс виртуальной машины

v2.210426
- Исправлена ошибка в парсере не позволяющая указать более 2х DNS-серверов в `vm_dns_servers` параметре

v2.210423
- Добавлен новый параметр виртуальной машины `vm_dns_servers`

v2.210409
- Добавлен вывод статуса обработанных виртуальных машин, вместо списка пропущенных
- Теперь все сообщения о статусах и ошибках выводятся в stderr
  (чтобы с помощью перенаправлений >/dev/null или 2>/dev/null можно было легко отключить лишний вывод)
- Добавлен ключ '-d' для команды 'create', который позволяет уничтожить старый инстанс виртуальной машины на другом гипервизоре

v2.210331
- Теперь при создании виртуальной машины её существование проверяется на всех гипервизорах, а не только
  на котором она будет создаваться (с помощью дополнительного ключа можно вернуть и прежнее поведение)
- Добавлен вывод списка (а не просто количества) пропущенных виртуальных машин при запуске команды 'create'
- Добавлена проверка на совпадение ipv4-адреса с ipv4-шлюзом в конфигурационном файле
- Исправлен дублирующий вывод ошибки при невозможности создания папки на гипервизоре для хранения ISO-образов
- Добавлена проверка дублирующихся определений ресурсов (гипервизоров или виртуальных машин) в конфигурационном файле

v1.210326
- Добавлен новый параметр виртуальной машины `vm_timezone`
- Отключено использование `vmxswap` для виртуальной машины в VMX-шаблоне
- Прекращено использование оператора `+=` для переопределения элементов ассоциативных массивов,
  т.к. в более ранних версиях `BASH`-интепретатора этот оператор не переопределял значение, а добавлял, если элемент
  массива уже существовал (проблема обнаружена в **bash v4.3.46** в составе `Ubuntu 16.04.2 LTS`)
- Прекращено использование `destination` формата (ssh://user@host:port) при вызове `SSH`-клиента
  для совместимости с более ранними версиями **OpenSSH** пакета, где этот формат ещё не поддерживался
  (проблема обнаружена в **openssh v7.2p2** в составе `Ubuntu 16.04.2 LTS`)
- В команду `ls` добавлено отображение параметров `vm_memory_mb` и `vm_vcpus`

v1.210316
- Добавлена установка параметра виртуальной машины `guestinfo.hostname`
- Сетевые настройки теперь также передаются через `guestinfo` параметры, а не MAC-адрес
- Добавлен параметр `StrictHostKeyChecking=no` для ssh
